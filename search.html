<HTML>
	<HEAD>
		<SCRIPT>var isomorphicDir="../smartclientRuntime/isomorphic/";</SCRIPT>
		<SCRIPT SRC=../smartclientRuntime/isomorphic/system/modules/ISC_Core.js></SCRIPT>
		<SCRIPT SRC=../smartclientRuntime/isomorphic/system/modules/ISC_Foundation.js></SCRIPT>
		<SCRIPT SRC=../smartclientRuntime/isomorphic/system/modules/ISC_Containers.js></SCRIPT>
		<SCRIPT SRC=../smartclientRuntime/isomorphic/system/modules/ISC_Grids.js></SCRIPT>
		<SCRIPT SRC=../smartclientRuntime/isomorphic/system/modules/ISC_Forms.js></SCRIPT>
		<SCRIPT SRC=../smartclientRuntime/isomorphic/system/modules/ISC_DataBinding.js></SCRIPT>
		<SCRIPT SRC=../smartclientRuntime/isomorphic/skins/Graphite/load_skin.js></SCRIPT>
	</HEAD>
	<BODY>
<SCRIPT>
isc.defineClass("myListGrid", "ListGrid").addProperties({
	alternateRecordStyles: true,
	autoFitFieldWidths: true,
	autoFitWidthApproach: 'title',
	canDragResize: true,
	height: 150,
	leaveScrollbarGap: false,
	left: 5,
	shadowOffset: 3,
	shadowSoftness: 7,
	showAllRecords: true,
	showShadow: true,
	width: 650,
	dataArrived: function(startRow, endRow){
		this.selectSingleRecord(startRow);
		this.recordClick(this, startRow, startRow);
	}
});
isc.defineClass("myDataSource", "DataSource").addProperties({
	dataFormat: "json",
	operationBindings:[{operationType:"fetch", dataProtocol:"postParams"}],
	handleError: function(response, request) {
		return true;
	}
});
isc.defineClass("myLabel", "Label").addProperties({
	baseStyle: "headerItem",
	height: 1,
	width: 500
});

isc.SearchLayout = isc.VLayout.create({
	canDragResize: true,
	name: "Search",
	parent: this,
	title: "Search",
	initWidget: function(initData){
		this.Super("initWidget", arguments);

		this.itemDS = isc.myDataSource.create({
			dataURL: "Items.php",
			ID: "itemDS",
			fields:[
				{name: "itemID", primaryKey: true, detail: true},
				{name: "class", valueMap:["Skill","Technique","Advantage","Equipment"], width: 80},
				{name: "source", detail: true},
				{name: "item_name", width: 150},
				{name: "itemType", width: 150},
				{name: "specialization", width: 100},
				{name: "canonical_name", detail: true},
				{name: "points", width: 50},
				{name: "reference", width: 50},
				{name: "difficulty", width: 50},
				{name: "type", width: 50},
				{name: "base_points", type: "integer", width: 50},
				{name: "quantity", detail: true},
				{name: "tech_level", detail: true},
				{name: "legality_class", width: 50},
				{name: "value", width: 50},
				{name: "levels", detail: true},
				{name: "cr", width: 50},
				{name: "points_per_level", width: 50},
				{name: "weight", width: 50},
				{name: "notes", width: 50, width: "*"},
				{name: "long_description", detail: true}
			]
		});
		this.defaultDS = isc.myDataSource.create({
			dataURL: "Defaults.php",
			ID: "defaultDS",
			fields:[
				{name: "defaultID", primaryKey: true, detail: true},
				{name: "itemID_fk", detail: true},
				{name: "type", width: 100},
				{name: "name"},
				{name: "modifier", width: 100},
				{name: "specialization", width: 200}
			]
		});
		this.prerequisiteDS = isc.myDataSource.create({
			dataURL: "Prerequisite.php",
			ID: "prerequisiteDS",
			fields:[
				{name: "prerequisiteID", primaryKey: true, detail: true},
				{name: "itemID_fk", detail: true},
				{name: "class", width: 100},
				{name: "name"},
				{name: "specialization", width: 100},
				{name: "notes", width: 100}
			]
		});
		this.bonusDS = isc.myDataSource.create({
			dataURL: "Bonuses.php",
			ID: "bonusDS",
			fields:[
				{name: "bonusID", primaryKey: true, detail: true},
				{name: "itemID_fk", detail: true},
				{name: "class", width: 100},
				{name: "name"},
				{name: "specialization", width: 100},
				{name: "amount", width: 100},
				{name: "attribute", width: 100}
			]
		});
		this.modifierDS = isc.myDataSource.create({
			dataURL: "Modifiers.php",
			ID: "modifierDS",
			fields:[
				{name: "modifierID", primaryKey: true, detail: true},
				{name: "itemID_fk", detail: true},
				{name: "name"},
				{name: "affects", width: 100},
				{name: "reference", width: 100},
				{name: "notes", width: 100}
			]
		});
		this.detailDS = isc.myDataSource.create({
			dataURL: "Details.php",
			ID: "categoryDS",
			fields:[
				{name: "detailID", primaryKey: true, detail: true},
				{name: "itemID_fk", detail: true},
				{name: "detail"}
			]
		});

		this.itemLG = isc.myListGrid.create({
			autoFetchData: true,
			dataSource: this.itemDS,
			ID: "itemLG",
			parent: this,
			height: 150,
			showFilterEditor: true,
			width: 1310,
			rowClick: function(record, recordNum, fieldNum, keyboardGenerated){
				this.parent.defaultLG.fetchData({itemID_fk: record.itemID});
				this.parent.prerequisiteLG.fetchData({itemID_fk: record.itemID});
				this.parent.bonusLG.fetchData({itemID_fk: record.itemID});
				this.parent.modifierLG.fetchData({itemID_fk: record.itemID});
				this.parent.detailLG.fetchData({itemID_fk: record.itemID});
			},
		});
		this.defaultLG = isc.myListGrid.create({
			dataSource: this.defaultDS,
			ID: "defaultLG"
		});
		this.prerequisiteLG = isc.myListGrid.create({
			dataSource: this.prerequisiteDS,
			ID: "prerequisiteLG"
		});
		this.bonusLG = isc.myListGrid.create({
			dataSource: this.bonusDS,
			ID: "bonusLG"
		});
		this.modifierLG = isc.myListGrid.create({
			dataSource: this.modifierDS,
			ID: "modifierLG"
		});
		this.detailLG = isc.myListGrid.create({
			dataSource: this.detailDS,
			ID: "detailLG",
			width: 1310
		});

		this.mainLB = isc.myLabel.create({contents: "<bold><h2>GURPS Search</h2></bold>"});
		this.ItemLB = isc.myLabel.create({contents: "<bold><h3>Items</h3></bold>"});
		this.DefaultLB = isc.myLabel.create({contents: "<bold><h3>Defaults</h3></bold>"});
		this.BonusLB = isc.myLabel.create({contents: "<bold><h3>Bonuses</h3></bold>"});
		this.PrerequisiteLB = isc.myLabel.create({contents: "<bold><h3>Prerequisites</h3></bold>"});
		this.ModifierLB = isc.myLabel.create({contents: "<bold><h3>Modifiers</h3></bold>"});
		this.DetailLB = isc.myLabel.create({contents: "<bold><h3>Details</h3></bold>"});

		this.SearchLayout = isc.VLayout.create({
			margin: 4,
			parent: this,
			members: [
				isc.VLayout.create({
					margin: 4,
					parent: this,
					members: [
						this.mainLB,
						this.ItemLB,
						this.itemLG,
						isc.HLayout.create({
							parent: this,
							margin: 4,
							members: [
								isc.VLayout.create({
									parent: this,
									margin: 4,
									members: [this.DefaultLB, this.defaultLG]
									}),
								isc.VLayout.create({
									parent: this,
									margin: 4,
									members: [this.BonusLB, this.bonusLG]
								})
							]
						}),
						isc.HLayout.create({
							parent: this,
							margin: 4,
							members: [
								isc.VLayout.create({
									parent: this,
									margin: 4,
									members: [this.PrerequisiteLB, this.prerequisiteLG]
									}),
								isc.VLayout.create({
									parent: this,
									margin: 4,
									members: [this.ModifierLB, this.modifierLG]
								})
							]
						})
						,
						isc.HLayout.create({
							parent: this,
							margin: 4,
							members: [
								isc.VLayout.create({
									parent: this,
									margin: 4,
									members: [this.DetailLB, this.detailLG]
									})
							]
						})
					],
				})
			]
		});
		this.addMember(this.SearchLayout);
		this.itemLG.filterData({class: "Skill"});
	}
});
</SCRIPT>
</BODY>
</HTML>
